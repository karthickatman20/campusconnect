<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Campus Connect - Sign Up</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="maincss.css">
   <style>
    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .card {
      border-radius: 20px;
      box-shadow: 0px 4px 15px rgba(0,0,0,0.2);
      transition: transform 0.2s;
    }
    .card:hover {
      transform: translateY(-8px);
    }
    small.error {
      color: red;
      display: none;
    }
  </style>
</head>
<body>

  <div class="container d-flex justify-content-center align-items-center vh-100">
    <div class="card p-4 shadow-lg" style="width: 30rem;">
      <div class="text-center mb-3">
        <img src="https://cdn-icons-png.flaticon.com/512/1828/1828466.png" width="70" class="mb-2">
        <h4 class="fw-bold">Create an Account</h4>
      </div>
      <form id="signupForm">
        <div class="mb-3">
          <input type="text" class="form-control" id="name" placeholder="Full Name">
          <small id="nameError" class="error">Name must contain only letters</small>
        </div>
        <div class="mb-3">
          <input type="text" class="form-control" id="regno" placeholder="Register Number">
          <small id="regnoError" class="error">Invalid Register Number (Ex: 23BCA1234)</small>
        </div>
        <div class="mb-3">
          <input type="text" class="form-control" id="email" placeholder="Email (must be VIT Email ID)">
          <small id="emailError" class="error">Format: firstname.lastnameYYYY@vitstudent.ac.in</small>
        </div>
        <div class="mb-3">
          <input type="text" class="form-control" id="address" placeholder="Address">
          <small id="addressError" class="error">Address is required</small>
        </div>
        <div class="mb-3">
          <input type="text" class="form-control" id="phone" placeholder="Phone No (10 digits)">
          <small id="phoneError" class="error">Phone number must be 10 digits</small>
        </div>
        <div class="mb-3">
          <input type="password" class="form-control" id="password" placeholder="Password">
          <small id="passwordError" class="error">Password must be at least 6 characters</small>
        </div>
        <div class="mb-3">
          <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm Password">
          <small id="confirmPasswordError" class="error">Passwords do not match</small>
        </div>
        <button type="submit" class="btn btn-success w-100">Sign Up</button>
      </form>
      <p class="mt-3 text-center">
        Already have an account? <a href="login.html">Login</a>
      </p>
    </div>
  </div>

  <!-- Bootstrap JS & jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Bootstrap JS & jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
$(document).ready(function() {
  console.log("Signup script loaded"); // Debug: make sure JS runs

  $("#signupForm").on("submit", async function(e) {
    e.preventDefault();

    let isValid = true;

    // Grab input values
    let name = $("#name").val().trim();
    let regno = $("#regno").val().trim();
    let email = $("#email").val().trim();
    let address = $("#address").val().trim();
    let phone = $("#phone").val().trim();
    let password = $("#password").val().trim();
    let confirmPassword = $("#confirmPassword").val().trim();

    // Hide previous errors
    $("small.error").hide();

    // ---------------------
    // Validation
    // ---------------------
    if (name === "" || !/^[A-Za-z\s]+$/.test(name)) {
      $("#nameError").text("Name must contain only letters").show();
      isValid = false;
    }

   let regnoPattern = /^23BCA0*(?:[1-9][0-9]{0,2}|1000)$/;
   if (regno === "") {
    $("#regnoError").text("Register number is required").show();
    isValid = false;
  } else if (!regnoPattern.test(regno)) {
    $("#regnoError").text("Enter valid Register No (e.g., 23BCA0001 - 23BCA1000)").show();
    isValid = false;
  } else {
    $("#regnoError").hide();
  }


    let emailPattern = /^[A-Za-z]+\.?[A-Za-z]+[0-9]{4}@vitstudent\.ac\.in$/;
    if (email === "") {
      $("#emailError").text("Email is required").show();
      isValid = false;
    } else if (!emailPattern.test(email)) {
      $("#emailError").text("Please enter a valid VIT student email address").show();
      isValid = false;
    } else {
      $("#emailError").hide();
    }

    if (address === "") {
      $("#addressError").text("Address is required").show();
      isValid = false;
    } else if (!/^[A-Za-z\s]+$/.test(address)) {
      $("#addressError").text("Address should contain only letters").show();
      isValid = false;
    } else {
      $("#addressError").hide();
    }

    if (phone === "") {
      $("#phoneError").text("Phone number is required").show();
        isValid = false;
      } else if (!/^[0-9]{10}$/.test(phone)) {
        $("#phoneError").text("Phone number must be exactly 10 digits").show();
        isValid = false;
      } else {
        $("#phoneError").hide();
      }


    if (password.length < 6) {
      $("#passwordError").text("Password must be at least 6 characters").show();
      isValid = false;
    }

    if (password !== confirmPassword) {
      $("#confirmPasswordError").text("Passwords do not match").show();
      isValid = false;
    }

    if (!isValid) {
      console.log("Validation failed:", { name, regno, email, address, phone, password });
      return;
    }

    // Debug: log values before sending to backend
    console.log("Sending data to backend:", { name, regno, email, address, phone, password });

    try {
      // Disable submit button while submitting
      const submitBtn = $("#signupForm button[type=submit]");
      submitBtn.prop("disabled", true).text("Registering...");

      const response = await fetch("http://localhost:5000/api/auth/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, regno, email, address, phone, password })
      });

      const data = await response.json();

      if (!response.ok) {
        alert("❌ " + (data.error || "Registration failed"));
        submitBtn.prop("disabled", false).text("Sign Up");
        return;
      }

      console.log("Backend response:", data);
      alert("✅ Registration successful! Redirecting to login...");
      window.location.href = "login.html";
    } catch (err) {
      console.error("Fetch error:", err);
      alert("Server error: " + err.message);
      $("#signupForm button[type=submit]").prop("disabled", false).text("Sign Up");
    }
  });
});
</script>


</body>
</html>