<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Campus Connect - Sign Up</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="maincss.css">
   <style>
    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding-top: 120px; /* ADDED: For navbar space */
    }
    .card {
      border-radius: 20px;
      box-shadow: 0px 4px 15px rgba(0,0,0,0.2);
      transition: transform 0.2s;
    }
    .card:hover {
      transform: translateY(-8px);
    }
    small.error {
      color: red;
      display: none;
    }
    .secret-code-section {
      display: none;
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      margin-top: 10px;
    }
    /* ADDED: Navbar styles */
    .nav-row {
      border-bottom: 1px solid #dee2e6;
    }
    .navbar-brand {
      font-weight: bold;
      font-size: 1.5rem;
    }
  </style>
</head>
<body class="d-flex flex-column">

  <!-- ADDED: Top Navbar Row 1 -->
  <nav class="navbar navbar-light bg-light fixed-top nav-row">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1">CampusConnect ðŸŽ“</span>
      <div class="d-flex">
        <button class="btn btn-outline-primary" onclick="goToHome()">Home</button>
      </div>
    </div>
  </nav>

  <!-- ADDED: Top Navbar Row 2 -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top nav-row" style="top: 56px;">
    <div class="container-fluid">
      <div class="navbar-nav">
        <a class="nav-link" href="contact.html">Contact Us</a>
        <a class="nav-link" href="services.html">Services</a>
        <a class="nav-link" href="address.html">Address</a>
      </div>
    </div>
  </nav>

  <div class="container d-flex justify-content-center align-items-center vh-100">
    <div class="card p-4 shadow-lg" style="width: 35rem;">
      <div class="text-center mb-3">
        <img src="https://cdn-icons-png.flaticon.com/512/1828/1828466.png" width="70" class="mb-2">
        <h4 class="fw-bold">Create an Account</h4>
      </div>
      <form id="signupForm">
        <div class="mb-3">
          <input type="text" class="form-control" id="name" placeholder="Full Name">
          <small id="nameError" class="error">Name must contain only letters</small>
        </div>
        <div class="mb-3">
          <input type="text" class="form-control" id="regno" placeholder="Register Number">
          <small id="regnoError" class="error">Invalid Register Number (Ex: 23BCA1234)</small>
        </div>
        <div class="mb-3">
          <input type="text" class="form-control" id="email" placeholder="Email (must be VIT Email ID)">
          <small id="emailError" class="error">Format: firstname.lastnameYYYY@vitstudent.ac.in</small>
        </div>
        <div class="mb-3">
          <input type="text" class="form-control" id="address" placeholder="Address">
          <small id="addressError" class="error">Address is required</small>
        </div>
        <div class="mb-3">
          <input type="text" class="form-control" id="phone" placeholder="Phone No (10 digits)">
          <small id="phoneError" class="error">Phone number must be 10 digits</small>
        </div>
        
        <!-- Role Selection -->
        <div class="mb-3">
          <label class="form-label fw-bold">Role</label>
          <select class="form-control" id="role">
            <option value="student">Student</option>
            <option value="admin">Admin</option>
          </select>
        </div>

        <div class="mb-3">
          <input type="password" class="form-control" id="password" placeholder="Password">
          <small id="passwordError" class="error">Password must be at least 6 characters</small>
        </div>
        <div class="mb-3">
          <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm Password">
          <small id="confirmPasswordError" class="error">Passwords do not match</small>
        </div>

        <!-- Secret Code Section (only for Admin) -->
        <div id="secretCodeSection" class="secret-code-section">
          <div class="mb-3">
            <label class="form-label fw-bold">Secret Code (for Admin only)</label>
            <input type="password" class="form-control" id="secretCode" placeholder="Enter secret code">
            <small id="secretCodeError" class="error">Secret code mismatch</small>
            <small class="text-muted">Contact system administrator for secret code</small>
          </div>
        </div>

        <button type="submit" class="btn btn-success w-100">Sign Up</button>
      </form>
      <p class="mt-3 text-center">
        Already have an account? <a href="login.html">Login</a>
      </p>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ADDED: Go to home function
    function goToHome() {
      window.location.href = "index.html";
    }

    $(document).ready(function() {
      // Show/hide secret code section based on role
      $("#role").on("change", function() {
        if ($(this).val() === "admin") {
          $("#secretCodeSection").show();
        } else {
          $("#secretCodeSection").hide();
          $("#secretCode").val("");
          $("#secretCodeError").hide();
        }
      });

      $("#signupForm").on("submit", async function(e) {
        e.preventDefault();

        let isValid = true;

        // Grab input values
        let name = $("#name").val().trim();
        let regno = $("#regno").val().trim();
        let email = $("#email").val().trim();
        let address = $("#address").val().trim();
        let phone = $("#phone").val().trim();
        let role = $("#role").val();
        let password = $("#password").val().trim();
        let confirmPassword = $("#confirmPassword").val().trim();
        let secretCode = $("#secretCode").val().trim();

        // Hide previous errors
        $("small.error").hide();

        // Validation
        if (name === "" || !/^[A-Za-z\s]+$/.test(name)) {
          $("#nameError").text("Name must contain only letters").show();
          isValid = false;
        }

        let regnoPattern = /^(23BCA)(0*(?:[1-9][0-9]{0,2}|1000))$/i;
        regno = regno.trim().toUpperCase();
        if (!regnoPattern.test(regno)) {
          $("#regnoError").text("Enter valid Register No (only 23BCA0001 - 23BCA1000, no special characters)").show();
          isValid = false;
        }

        let emailPattern = /^[A-Za-z]+\.?[A-Za-z]+[0-9]{4}@vitstudent\.ac\.in$/;
        if (email === "") {
          $("#emailError").text("Email is required").show();
          isValid = false;
        } else if (!emailPattern.test(email)) {
          $("#emailError").text("Please enter a valid VIT student email address").show();
          isValid = false;
        }

        if (address === "") {
          $("#addressError").text("Address is required").show();
          isValid = false;
        } else if (!/^[A-Za-z\s]+$/.test(address)) {
          $("#addressError").text("Address should contain only letters").show();
          isValid = false;
        }

        if (phone === "") {
          $("#phoneError").text("Phone number is required").show();
          isValid = false;
        } else if (!/^[0-9]{10}$/.test(phone)) {
          $("#phoneError").text("Phone number must be exactly 10 digits").show();
          isValid = false;
        }

        if (password.length < 6) {
          $("#passwordError").text("Password must be at least 6 characters").show();
          isValid = false;
        }

        if (password !== confirmPassword) {
          $("#confirmPasswordError").text("Passwords do not match").show();
          isValid = false;
        }

        // Secret code validation for admin
        if (role === "admin") {
          if (secretCode !== "campus") {
            $("#secretCodeError").text("Secret code mismatch").show();
            isValid = false;
          }
        }

        if (!isValid) return;

        try {
          const submitBtn = $("#signupForm button[type=submit]");
          submitBtn.prop("disabled", true).text("Registering...");

          const response = await fetch("http://localhost:5000/api/auth/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, regno, email, address, phone, role, password })
          });

          const data = await response.json();

          if (!response.ok) {
            alert("âŒ " + (data.error || "Registration failed"));
            submitBtn.prop("disabled", false).text("Sign Up");
            return;
          }

          alert("âœ… Registration successful! Redirecting to login...");
          window.location.href = "login.html";
        } catch (err) {
          console.error("Fetch error:", err);
          alert("Server error: " + err.message);
          $("#signupForm button[type=submit]").prop("disabled", false).text("Sign Up");
        }
      });
    });
</script>
</body>
</html>