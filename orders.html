<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Orders - CampusConnect</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(to right, #56ccf2, #2f80ed);
      min-height: 100vh;
      font-family: 'Poppins', sans-serif;
    }
    .order-card {
      border-radius: 12px;
      background: #fff;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    .ordered-text {
      color: green;
      font-weight: bold;
    }
  </style>
</head>
<body class="container py-4">

  <h3 class="text-center text-light fw-bold mb-4">My Orders</h3>

  <div id="ordersContainer"></div>

  <div class="text-center">
    <a href="home.html" class="btn btn-light mt-3">Back to Home</a>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script>
async function loadOrders() {
  try {
    const buyerId = localStorage.getItem("userId"); // Get logged-in user
    const res = await fetch(`http://localhost:5000/api/orders?buyerId=${buyerId}`);
    const orders = await res.json();

    const container = $("#ordersContainer");
    container.empty();

    if (!orders.length) {
      container.html('<p class="text-center text-white">No orders yet.</p>');
      return;
    }

orders.forEach(order => {
  const prod = order.product || {};
  const img = prod.imageUrl || "https://via.placeholder.com/200x150?text=No+Image";
  const card = `
    <div class="order-card">
      <img src="${img}" alt="${prod.title || 'Product'}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 10px; margin-bottom: 15px;">
      <h5>${prod.title || "Unnamed Product"}</h5>
      <p>ðŸ‘¤ Seller: ${prod.user?.name || "Unknown"}</p>
      <p>ðŸ“ž Contact: ${prod.user?.phone || "N/A"}</p>
      <p class="ordered-text">âœ… Ordered Successfully</p>
      <button class="btn btn-danger cancel-btn" data-id="${order._id}">Cancel Order</button>
    </div>
  `;
  container.append(card);
});
  } catch (err) {
    console.error(err);
    $("#ordersContainer").html('<p class="text-danger text-center">Failed to load orders.</p>');
  }
}

  $(document).on("click", ".cancel-btn", async function() {
    const id = $(this).data("id");
    if (!confirm("Cancel this order?")) return;

    try {
      const res = await fetch(`http://localhost:5000/api/orders/${id}`, { method: "DELETE" });
      const data = await res.json();
      alert(data.message);
      loadOrders(); // reload list
    } catch (err) {
      alert("Error cancelling order");
    }
  });

  $(document).ready(loadOrders);
  </script>
</body>
</html>
