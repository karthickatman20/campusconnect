<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Report Found Item | CampusConnect</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="maincss.css" />
  <style>
    body {
      background: linear-gradient(to right, #64dfdf, #80ffdb, #72efdd, #48bfe3, #5390d9, #5e60ce);
      padding-top: 70px; /* ensures content starts below sticky navbar */
    }
    .details-card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
      padding: 24px;
      max-width: 850px;
      margin: 20px auto;
    }
    .product-image {
      width: 100%;
      max-height: 360px;
      object-fit: cover;
      border-radius: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: none;
      margin-bottom: 16px;
    }
    /* Move CampusConnect text slightly upwards */
    .navbar .navbar-brand {
      margin-top: -4px; /* adjust value if needed (-6px, -8px, etc.) */
    }
  </style>
</head>
<body class="d-flex flex-column">

  <!-- Navbar -->
  <nav class="navbar navbar-light bg-light shadow-sm w-100 fixed-top">
    <div class="container-fluid d-flex justify-content-between align-items-center">
      <button class="btn btn-outline-secondary me-auto" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu">‚ò∞</button>
      <span class="navbar-brand mb-0 h1 fw-bold position-absolute start-50 translate-middle-x">
        CampusConnect
      </span>
    </div>
  </nav>

  <!-- Sidebar -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="sidebarMenu">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title">Menu</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
      <ul class="list-unstyled">
        <li><a href="home.html" class="btn btn-outline-primary w-100 mb-2">Home</a></li>
        <li><a href="contact.html" class="btn btn-outline-success w-100 mb-2">Contact Us</a></li>
        <li><a href="login.html" class="btn btn-outline-danger w-100">Sign Out</a></li>
      </ul>
    </div>
  </div>

  <!-- Form -->
  <div class="container">
    <div class="details-card">
      <h3 class="fw-bold mb-3 text-center">Found Someone's Lost Product</h3>

      <!-- Image Preview -->
      <img id="previewImg" class="product-image" alt="Found Product Preview" />

      <form id="foundForm">
        <div class="mb-3">
          <label class="form-label fw-bold">Upload the Image of the Found Product</label>
          <input type="file" id="foundImage" class="form-control" accept="image/*">
        </div>

        <div class="mb-3">
          <label class="form-label fw-bold">Name of the Product</label>
          <input type="text" id="foundName" class="form-control" placeholder="Eg: Wallet, Bottle, Book">
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label fw-bold">Your Name</label>
            <input type="text" id="finderName" class="form-control" placeholder="Enter Your Name">
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label fw-bold">Your Register No</label>
            <input type="text" id="finderReg" class="form-control" placeholder="Eg: 23BCA0067">
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label fw-bold">Your Phone No</label>
          <input type="tel" id="finderPhone" class="form-control" placeholder="10-digit phone number">
        </div>

        <button type="submit" class="btn btn-success w-100">Submit</button>
      </form>
    </div>

    <div class="text-center">
      <a href="sell_choose.html" class="btn btn-primary mt-3">Back</a>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
  // Image preview
  $("#foundImage").on("change", function(e) {
    const file = e.target.files[0];
    if (!file) return;
    const url = URL.createObjectURL(file);
    $("#previewImg").attr("src", url).show();
  });

  // Submit to backend
  $("#foundForm").on("submit", async function(e) {
    e.preventDefault();

    const name = $("#foundName").val().trim();
    const finderName = $("#finderName").val().trim();
    const reg = $("#finderReg").val().trim();
    const phone = $("#finderPhone").val().trim();
    const file = $("#foundImage")[0].files[0];
    const token = localStorage.getItem("token");

    if (!name || !finderName || !reg || !phone) {
      alert("‚ö†Ô∏è Please fill all fields.");
      return;
    }
    if (!/^\d{10}$/.test(phone)) {
      alert("‚ö†Ô∏è Enter a valid 10-digit phone number.");
      return;
    }

    // Prepare description text
    const description = `Finder Name: ${finderName}\nRegister No: ${reg}\nPhone: ${phone}`;

    let imageBase64 = "";

    const sendPayload = async () => {
      const payload = {
        title: name,
        description,
        price: 0,
        category: "lost",
        imageUrl: imageBase64
      };

      try {
        const res = await fetch("http://localhost:5000/api/products", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
          },
          body: JSON.stringify(payload)
        });

        const data = await res.json();

        if (!res.ok) {
          alert("‚ùå " + (data.error || "Failed to report found item"));
          return;
        }

        alert("‚úÖ Found item reported successfully!");
        window.location.href = "lost.html";
      } catch (err) {
        alert("üö´ Server error: " + err.message);
      }
    };

    if (file) {
      const reader = new FileReader();
      reader.onloadend = async function() {
        imageBase64 = reader.result;
        await sendPayload();
      };
      reader.readAsDataURL(file);
    } else {
      await sendPayload();
    }
  });
</script>

</body>
</html>
