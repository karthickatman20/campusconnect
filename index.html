<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Campus Connect - Home</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="maincss.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    .card img {
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
      height: 180px;
      object-fit: cover;
    }
    
    /* Navbar Styles */
    .navbar-brand {
      font-weight: bold;
      font-size: 1.5rem;
    }
    
    .nav-row {
      border-bottom: 1px solid #dee2e6;
    }

    .message-badge {
  position: absolute;
  top: -5px;
  right: -5px;
  background: #dc3545;
  color: white;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  font-size: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
}
    
    /* Footer */
    footer {
      background: rgba(255, 255, 255, 0.9);
      text-align: center;
      padding: 15px;
      border-radius: 10px 10px 0 0;
      font-size: 14px;
      box-shadow: 0px -2px 10px rgba(0,0,0,0.1);
      margin-top: 30px;
    }
    footer .social-icons {
      margin-top: 10px;
    }
    footer .social-icons a {
      margin: 0 8px;
      font-size: 20px;
      color: #333;
      transition: 0.3s;
    }
    footer .social-icons a:hover {
      color: #007bff;
    }
    footer hr {
      margin-bottom: 15px;
    }

    /* Card hover effects */
    .card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
  </style>
</head>
<body class="d-flex flex-column">

  <!-- Top Navbar Row 1 -->
  <nav class="navbar navbar-light bg-light nav-row">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1">CampusConnect ðŸŽ“</span>
      <div class="d-flex">
        <!-- Add this div right before the authButton in the first navbar row -->
         <div class="position-relative me-3">
        <button class="btn btn-outline-primary position-relative" onclick="viewMessages()">
        <i class="fas fa-bell"></i>
        <span class="message-badge" id="messageCount">0</span>
        </button>
        </div>
        <button id="authButton" class="btn btn-outline-primary" onclick="handleAuth()">Login</button>
      </div>
    </div>
  </nav>

  <!-- Top Navbar Row 2 -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light nav-row" id="mainNavbar">
    <div class="container-fluid">
      <div class="navbar-nav" id="navLinks">
        <!-- Links will be populated dynamically based on login status -->
      </div>
    </div>
  </nav>

  <!-- Welcome Section -->
  <div class="text-center mt-4">
    <h2 class="fw-bold">Welcome to CampusConnect</h2>
    <p class="text-muted">Your place to buy, sell, and find lost items inside campus.</p>
  </div>

  <!-- Center Cards -->
  <div class="container d-flex justify-content-center align-items-center flex-grow-1">
    <div class="row g-4 text-center">

      <!-- Buy Card -->
      <div class="col-md-4">
        <div class="card h-100">
          <img src="buy.jpg" alt="Buy">
          <div class="card-body">
            <h5 class="card-title fw-bold">Looking something to Buy?</h5>
            <button class="btn btn-primary mt-2" onclick="handleBuyClick()">Buy</button>
          </div>
        </div>
      </div>

      <!-- Sell Card -->
      <div class="col-md-4">
        <div class="card h-100">
          <img src="sell.jpg" alt="Sell">
          <div class="card-body">
            <h5 class="card-title fw-bold">Do you want to sell your Items?</h5>
            <button class="btn btn-success mt-2" onclick="handleSellClick()">Sell</button>
          </div>
        </div>
      </div>

      <!-- Search Card -->
      <div class="col-md-4">
        <div class="card h-100">
          <img src="lost.jpg" alt="Search">
          <div class="card-body">
            <h5 class="card-title fw-bold">Searching for any of your items?</h5>
            <button class="btn btn-warning mt-2" onclick="handleSearchClick()">Search Here</button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- About Section -->
  <div class="container mt-5">
    <h3 class="fw-bold text-center">About CampusConnect</h3>
    <p class="text-center mt-3">
      CampusConnect is designed to help students easily buy and sell items within their campus, 
      and also find their lost belongings. Whether you're looking for affordable study materials, 
      selling your used items, or finding lost items, this platform is built exclusively for your campus community.
    </p>
  </div>

  <!-- Footer -->
  <footer>
    <hr>
    Â© 2025 CampusConnect | Made by CampusConnect Team
    <div class="social-icons">
      <a href="#"><i class="fab fa-instagram"></i></a>
      <a href="#"><i class="fab fa-twitter"></i></a>
      <a href="#"><i class="fab fa-linkedin"></i></a>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Check login status and update navbar
    function updateNavbar() {
      const token = localStorage.getItem('token');
      const userRole = localStorage.getItem('userRole');
      const authButton = document.getElementById('authButton');
      const navLinks = document.getElementById('navLinks');
      
      if (token) {
        // User is logged in
        authButton.textContent = 'Sign Out';
        authButton.className = 'btn btn-outline-danger';
        
        let adminLink = '';
        if (userRole === 'admin') {
          adminLink = '<a class="nav-link" href="admin_dashboard.html">Admin Panel</a>';
        }
        
        navLinks.innerHTML = `
          ${adminLink}
          <a class="nav-link" href="index.html">Home</a>
          <a class="nav-link" href="profile.html">View Profile</a>
          <a class="nav-link" href="orders.html">My Orders</a>
          <a class="nav-link" href="feedback.html">Feedback</a>
          <a class="nav-link" href="contact.html">Contact Us</a>
          <a class="nav-link" href="services.html">Services</a>
          <a class="nav-link" href="address.html">Address</a>
        `;
      } else {
        // User is not logged in
        authButton.textContent = 'Login';
        authButton.className = 'btn btn-outline-primary';
        
        navLinks.innerHTML = `
          <a class="nav-link" href="contact.html">Contact Us</a>
          <a class="nav-link" href="services.html">Services</a>
          <a class="nav-link" href="address.html">Address</a>
        `;
      }
    }

    // Handle authentication button click
    function handleAuth() {
      const token = localStorage.getItem('token');
      if (token) {
        // Sign out
        localStorage.removeItem('token');
        localStorage.removeItem('userId');
        localStorage.removeItem('username');
        localStorage.removeItem('userRole');
        updateNavbar();
        window.location.href = 'index.html';
      } else {
        // Go to login
        window.location.href = 'login.html';
      }
    }

    // Handle feature clicks with authentication check
    function handleBuyClick() {
      if (!localStorage.getItem('token')) {
        alert('Please login first to access Buy features');
        window.location.href = 'login.html';
        return;
      }
      window.location.href = 'buy.html';
    }

    function handleSellClick() {
      if (!localStorage.getItem('token')) {
        alert('Please login first to access Sell features');
        window.location.href = 'login.html';
        return;
      }
      window.location.href = 'sell_choose.html';
    }

    function handleSearchClick() {
      if (!localStorage.getItem('token')) {
        alert('Please login first to access Search features');
        window.location.href = 'login.html';
        return;
      }
      window.location.href = 'lost.html';
    }
    // Load message count for navbar
async function loadMessageCount() {
  try {
    const token = localStorage.getItem('token');
    const response = await fetch('http://localhost:5000/api/messages/unread-count', {
      headers: {
        'Authorization': 'Bearer ' + token
      }
    });
    
    if (response.ok) {
      const data = await response.json();
      document.getElementById('messageCount').textContent = data.count;
    }
  } catch (err) {
    console.error('Error loading message count:', err);
  }
}

function viewMessages() {
  window.location.href = 'messages.html';
}

// Call loadMessageCount when page loads for logged-in users
document.addEventListener('DOMContentLoaded', function() {
  const token = localStorage.getItem('token');
  if (token) {
    loadMessageCount();
  }
});

    // Initialize navbar on page load
    document.addEventListener('DOMContentLoaded', updateNavbar);
  </script>
</body>
</html>